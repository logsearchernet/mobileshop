<% for(var i=0; i<data.length; i++) {%>
    <tr class="iedit">
        <td class="row-selector text-center">
            <div class="checkbox checkbox-inline checkbox-styled">
                <label>
                    <input type="checkbox" class="checkItem" value="<%=data[i].id%>"><span></span>
                </label>
            </div>
        </td>
        <td><%=data[i].id%></td>
        <td>
            <div><%=data[i].name%></div>
            <div class="row-actions">
                <span class="edit"><i class="fa fa-edit"></i> <a href="<%=basePath%>category/category_form/<%=data[i].id%>" title="Edit this item">Edit</a> | </span>
                <span class="trash"><i class="fa fa-trash-o"></i> <a class="submitdelete" title="Move this item to the Trash" href="#" id="<%=data[i].id%>">Trash</a> | </span>
                <span class="view"><i class="fa fa-eye"></i> <a href="<%=basePath%>category/category_view/<%=data[i].id%>" title="View Child" rel="permalink">View Child</a></span>
            </div>
        </td>
        <td><%=data[i].description%></td>
        <td class="pointer dragHandle center">
            <div class="dragGroup">
                <div class="positions">
                    <button type="button" class="btn btn-link move-row ui-sortable-handle" categoryid="<%=data[i].id%>" value="<%=data[i].position%>"><i class="fa fa-arrows fa-lg"></i></button> <%=data[i].position%>
                </div>
            </div>
        </td>
        <td>
            <input id="switch-state" type="checkbox" name="displayed" categoryid="<%=data[i].id%>" <%=(data[i].displayed == '1')?'checked="checked"':''%>/>
        </td>
    </tr>
    <%
}
%>
<script>
$(document).ready(function(){
    
    doSortTableRow();
    $('.row-actions').hide();
    $("[name='displayed']").bootstrapSwitch();
    $("[name='displayed']").on('switchChange.bootstrapSwitch', function(event, state) {
        var categoryid = $(this).attr("categoryid");
        var displayed = ($(this).attr("checked")=='checked')?1:0;
        var url = basePath+"category/ajax_category_displayed";
        var callbackName = "categoryDisplay";
        var obj = new Object();
        obj.id = categoryid;
        obj.displayed = displayed;    
        callAjax(obj, url, callbackName);
    });

    $(".iedit").mouseover(function(){
        $('.row-actions').hide();
        $(this).find('.row-actions').show();
    });

});

function doSortTableRow(){
    $("#category-table").sortable({
    	handle:'button.move-row',
        helper: fixWidthHelper,
    	cancel: '',
    	update: function(event, ui) {
            var newProps = new Array(0);
            $('.iedit').each(function(i) { 
                var sortNum = $(this).find('button.move-row').val();
                var categoryid = $(this).find('button.move-row').attr('categoryid');

                var obj = new Object();
                obj.categoryid = categoryid;
                obj.sortNum = sortNum;
                
                newProps.push(obj);
            });
            //alert(JSON.stringify(newProps));
            var callbackName = "updateSortPosition";
            callAjax(newProps, updateSortPosition, callbackName);
    	}
    });
}

function fixWidthHelper(e, ui) {
    ui.children().each(function() {
        $(this).width($(this).width());
    });
    return ui;
}
</script>